{% assign fcount = site.data.config-table | size %}
<!-- load DataTables with jquery bundled -->
<script type="text/javascript" language="javascript" src="{{ '/bootstrap5/datatables/datatables.min.js' | prepend: site.digital-assets }}"></script>
<script>
function submitFilter() {
        query = document.querySelector('#filterTextBox').value.replace('http://','').replace('https://','').replace(':80','').replace('digital.lib.uidaho.edu/cdm/ref/','').replace('digital.lib.uidaho.edu/digital/','').replace('cdm17254.contentdm.oclc.org/cdm/ref/','').split('/rec/')[0];
        table.search(query).draw();
    }

    let table = new DataTable('#item-table', {
        // use DataTables ajax load 
        ajax: { url: '{{ "/assets/js/metadata.min.json" | relative_url }}', dataSrc: 'objects' },
        // defer render to speed up large sets
        "deferRender": true,
        // enable pagination 
        "paging": true,
        "lengthMenu": [[ 25, 50, 100, -1], [ 25, 50, 100, "All"]],
        // add download features
        dom: 'B<"row mt-2"<"col-md-6"l><"col-md-6"f>>t<"row"<"col-md-6"i><"col-md-6"p>>', 
        buttons: [ 'excelHtml5', 'csvHtml5' ],
        // get the data from json
        columns: [ {% for i in (0..fcount) %}{ data: '{{ i }}' }{% unless forloop.last %},{% endunless %}{% endfor %} ],
        columnDefs: [ 
            // turn relative link into absolute
            { "render": function ( data ) { return '{{ "/" | relative_url }}' + data; },"targets": {{ fcount }} },
            // combine link with first column
            { "render": function ( data, type, row ) { return '<a href="' + row['{{ fcount }}'] +'">'+ data +'</a>'; },"targets": 0 },
            // hide the link column
            { "visible": false,  "targets": [ {{ fcount }} ] }
        ],
        // sort based on the second column
        order: [[ 1, "asc" ]]
    });

    
    var searchForm = document.querySelector('#searchForm');
    searchForm.innerHTML = `<form role="search" id="lunrSearch" onsubmit="submitFilter(); return false;">
            <div class="input-group">
                <input type="text" class="form-control" id="filterTextBox" placeholder="Old link ... " aria-label="Search Old Link"> 
                <button class="btn btn-success" type="submit" title="Filter items" id="filterButton" >Search</button>
            </div>
        </form>`;
    

</script>
